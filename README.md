# ğŸŒ BananaCMS

<div align="right">
  <a href="README.en.md">English</a> | <strong>ä¸­æ–‡</strong>
</div>

è½»é‡çº§å½±è§†å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ŒåŸç”Ÿ PHP å¼€å‘ï¼Œæ— æ¡†æ¶ä¾èµ–ï¼Œå¼€ç®±å³ç”¨ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸš€ **è½»é‡é«˜æ•ˆ** - åŸç”Ÿ PHP 8.0+ï¼Œæ— æ¡†æ¶ä¾èµ–ï¼Œæ€§èƒ½ä¼˜å¼‚
- ğŸ“¦ **å¼€ç®±å³ç”¨** - å®‰è£…å‘å¯¼ï¼Œ5åˆ†é’Ÿéƒ¨ç½²ä¸Šçº¿
- ğŸ¬ **æ™ºèƒ½é‡‡é›†** - å¯¹æ¥èµ„æºç«™ APIï¼Œè‡ªåŠ¨é‡‡é›†å…¥åº“ï¼Œå®šæ—¶ä»»åŠ¡
- ğŸ“± **çŸ­è§†é¢‘/çŸ­å‰§** - ç«–å±æ»‘åŠ¨æ’­æ”¾ï¼Œå‰§é›†ç®¡ç†ï¼Œéšæœºæ¨è
- ğŸ’¬ **é«˜çº§è¯„è®º** - æ¥¼ä¸­æ¥¼å›å¤ï¼Œç‚¹èµè¸©ï¼Œæ•æ„Ÿè¯è¿‡æ»¤ï¼Œè¯„è®ºå®¡æ ¸
- â­ **è¯„åˆ†ç³»ç»Ÿ** - 1-10åˆ†è¯„åˆ†ï¼Œç»Ÿè®¡åˆ†å¸ƒï¼Œè¯„åˆ†è¶‹åŠ¿
- ğŸ“¢ **å¹¿å‘Šç³»ç»Ÿ** - 10ä¸ªå¹¿å‘Šä½ï¼Œ4ç§å¹¿å‘Šç±»å‹ï¼Œç‚¹å‡»ç»Ÿè®¡
- ğŸ“Š **æ•°æ®ç»Ÿè®¡** - UV/PVè¶‹åŠ¿ï¼Œæ¥æºåˆ†æï¼Œçƒ­é—¨æ’è¡Œï¼Œå®æ—¶ç›‘æ§
- ğŸ”Œ **å®Œæ•´API** - 40+ RESTful æ¥å£ï¼ŒTokenè®¤è¯ï¼Œæ”¯æŒ APP å¼€å‘
- â˜ï¸ **äº‘å­˜å‚¨** - æ”¯æŒ Cloudflare R2ï¼Œæœ¬åœ°/äº‘ç«¯åŒå­˜å‚¨
- âš¡ **Redisç¼“å­˜** - é«˜é€Ÿç¼“å­˜å’ŒSessionï¼Œæ–‡ä»¶/RedisåŒé©±åŠ¨
- ğŸ”’ **å®‰å…¨é˜²æŠ¤** - SQLæ³¨å…¥/XSS/CSRFé˜²æŠ¤ï¼Œç®¡ç†å‘˜IPæ··æ·†
- ğŸ¨ **æ¨¡æ¿ç³»ç»Ÿ** - è‡ªå®šä¹‰æ ‡ç­¾ï¼Œ5ç§URLæ¨¡å¼ï¼ŒSEOä¼˜åŒ–
- ğŸ”„ **è§†é¢‘è½¬ç ** - FFmpegè½¬ç ï¼Œè¿›åº¦è·Ÿè¸ªï¼Œè½¬ç å¹¿å‘Š

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

- PHP 8.0+
- MySQL 5.7+
- PDO æ‰©å±•

å¯é€‰ï¼š
- Redis æ‰©å±•ï¼ˆé«˜é€Ÿç¼“å­˜ï¼‰
- cURL æ‰©å±•ï¼ˆé‡‡é›†/äº‘å­˜å‚¨ï¼‰

## ğŸš€ å¿«é€Ÿå®‰è£…

1. ä¸‹è½½ä»£ç åˆ°ç½‘ç«™ç›®å½•
2. è®¿é—® `http://ä½ çš„åŸŸå/install.php`
3. æŒ‰å‘å¯¼å¡«å†™æ•°æ®åº“ä¿¡æ¯
4. å®Œæˆï¼è®¿é—® `/admin.php` è¿›å…¥åå°

## ğŸ“ ç›®å½•ç»“æ„

```
â”œâ”€â”€ index.php           # å‰å°å…¥å£
â”œâ”€â”€ admin.php           # åå°å…¥å£
â”œâ”€â”€ api.php             # APIå…¥å£
â”œâ”€â”€ install.php         # å®‰è£…å‘å¯¼
â”œâ”€â”€ cron.php            # å®šæ—¶ä»»åŠ¡
â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶
â”œâ”€â”€ core/               # æ ¸å¿ƒç±»åº“
â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹
â”œâ”€â”€ controllers/        # æ§åˆ¶å™¨
â”œâ”€â”€ views/              # åå°è§†å›¾
â”œâ”€â”€ template/           # å‰å°æ¨¡æ¿
â”œâ”€â”€ static/             # é™æ€èµ„æº
â”œâ”€â”€ upload/             # ä¸Šä¼ ç›®å½•
â””â”€â”€ runtime/            # ç¼“å­˜/æ—¥å¿—
```


## ğŸ¯ åŠŸèƒ½æ¸…å•

### å‰å°åŠŸèƒ½
- âœ… **é¦–é¡µç³»ç»Ÿ** - æ¨è/æœ€æ–°/çƒ­é—¨è§†é¢‘ï¼Œåˆ†ç±»èšåˆï¼Œè½®æ’­å›¾
- âœ… **è§†é¢‘ç³»ç»Ÿ** - åˆ†ç±»ç­›é€‰ï¼Œè¯¦æƒ…æ’­æ”¾ï¼Œè‡ªåŠ¨è¿æ’­ï¼Œæ’­æ”¾è®°å½•
- âœ… **çŸ­è§†é¢‘/çŸ­å‰§** - ç«–å±æ»‘åŠ¨ï¼Œå‰§é›†ç®¡ç†ï¼Œéšæœºæ¨èï¼Œåˆ†ç±»æµè§ˆ
- âœ… **æ¼”å‘˜ç³»ç»Ÿ** - æ¼”å‘˜åˆ—è¡¨ï¼Œæ¼”å‘˜è¯¦æƒ…ï¼Œä½œå“å±•ç¤ºï¼Œæ¼”å‘˜æœç´¢
- âœ… **æ–‡ç« ç³»ç»Ÿ** - æ–‡ç« åˆ—è¡¨ï¼Œæ–‡ç« è¯¦æƒ…ï¼Œæ–‡ç« åˆ†ç±»ï¼Œæ–‡ç« æœç´¢
- âœ… **æœç´¢åŠŸèƒ½** - å…¨ç«™æœç´¢ï¼Œçƒ­é—¨æœç´¢ï¼Œæœç´¢å»ºè®®ï¼Œæœç´¢å†å²
- âœ… **ç”¨æˆ·ç³»ç»Ÿ** - æ³¨å†Œç™»å½•ï¼Œä¸ªäººä¸­å¿ƒï¼Œèµ„æ–™ä¿®æ”¹ï¼Œå¯†ç ä¿®æ”¹
- âœ… **äº’åŠ¨åŠŸèƒ½** - è¯„è®ºå›å¤ï¼Œè§†é¢‘è¯„åˆ†ï¼Œç‚¹èµè¸©ï¼Œæ”¶è—å†å²
- âœ… **å‹æƒ…é“¾æ¥** - é“¾æ¥å±•ç¤ºï¼Œé“¾æ¥ç”³è¯·ï¼Œé“¾æ¥åˆ†ç±»
- âœ… **å•é¡µé¢** - å…³äºæˆ‘ä»¬ï¼Œè”ç³»æ–¹å¼ï¼Œå…è´£å£°æ˜ï¼Œè‡ªå®šä¹‰é¡µé¢

### åå°åŠŸèƒ½
- âœ… **ä»ªè¡¨ç›˜** - æ•°æ®æ¦‚è§ˆï¼Œä»Šæ—¥ç»Ÿè®¡ï¼Œç³»ç»ŸçŠ¶æ€ï¼Œå¿«æ·æ“ä½œ
- âœ… **è§†é¢‘ç®¡ç†** - è§†é¢‘CRUDï¼Œæ‰¹é‡æ“ä½œï¼Œæ’­æ”¾æºç®¡ç†ï¼Œè§†é¢‘é”å®š
- âœ… **åˆ†ç±»ç®¡ç†** - æ ‘å½¢ç»“æ„ï¼Œåˆ†ç±»CRUDï¼Œæ‰¹é‡æ“ä½œï¼Œåˆ†ç±»æ’åº
- âœ… **æ¼”å‘˜ç®¡ç†** - æ¼”å‘˜ä¿¡æ¯ï¼Œä½œå“å…³è”ï¼Œæ¼”å‘˜ç»Ÿè®¡ï¼Œæ‰¹é‡å¯¼å…¥
- âœ… **æ–‡ç« ç®¡ç†** - æ–‡ç« å‘å¸ƒï¼Œç¼–è¾‘å™¨ï¼Œæ–‡ç« åˆ†ç±»ï¼Œæ–‡ç« ç»Ÿè®¡
- âœ… **ç”¨æˆ·ç®¡ç†** - ç”¨æˆ·åˆ—è¡¨ï¼Œç”¨æˆ·ç¼–è¾‘ï¼Œç”¨æˆ·ç¦ç”¨ï¼Œç”¨æˆ·ç»Ÿè®¡
- âœ… **é‡‡é›†ç®¡ç†** - é‡‡é›†ç«™é…ç½®ï¼Œé‡‡é›†ä»»åŠ¡ï¼Œé‡‡é›†æ—¥å¿—ï¼Œå®šæ—¶é‡‡é›†
- âœ… **å¹¿å‘Šç®¡ç†** - å¹¿å‘Šä½é…ç½®ï¼Œå¹¿å‘ŠæŠ•æ”¾ï¼Œç‚¹å‡»ç»Ÿè®¡ï¼Œå¹¿å‘Šæ’åº
- âœ… **è¯„è®ºç®¡ç†** - è¯„è®ºå®¡æ ¸ï¼Œè¯„è®ºåˆ é™¤ï¼Œæ•æ„Ÿè¯é…ç½®ï¼Œè¯„è®ºç»Ÿè®¡
- âœ… **çŸ­è§†é¢‘ç®¡ç†** - çŸ­è§†é¢‘/çŸ­å‰§ç®¡ç†ï¼Œåˆ†é›†ç®¡ç†ï¼ŒçŠ¶æ€æ§åˆ¶
- âœ… **æ•°æ®ç»Ÿè®¡** - UV/PVè¶‹åŠ¿ï¼Œæ¥æºåˆ†æï¼Œçƒ­é—¨æ’è¡Œï¼Œæ•°æ®å¯¼å‡º
- âœ… **è½¬ç ç®¡ç†** - è½¬ç ä»»åŠ¡ï¼Œè½¬ç è¿›åº¦ï¼Œè½¬ç å¹¿å‘Šï¼Œè½¬ç ç»Ÿè®¡
- âœ… **å‹é“¾ç®¡ç†** - å‹é“¾å®¡æ ¸ï¼Œé“¾æ¥æ£€æŸ¥ï¼Œé“¾æ¥åˆ†ç±»ï¼Œé“¾æ¥ç»Ÿè®¡
- âœ… **æ“ä½œæ—¥å¿—** - ç®¡ç†å‘˜æ“ä½œï¼Œæ—¥å¿—æŸ¥è¯¢ï¼Œæ—¥å¿—æ¸…ç†ï¼Œå®‰å…¨å®¡è®¡
- âœ… **ç³»ç»Ÿé…ç½®** - ç«™ç‚¹ä¿¡æ¯ï¼ŒSEOé…ç½®ï¼Œç¼“å­˜é…ç½®ï¼Œå­˜å‚¨é…ç½®
- âœ… **æ’­æ”¾å™¨ç®¡ç†** - æ’­æ”¾å™¨é…ç½®ï¼Œæ’­æ”¾å™¨å¯ç”¨ï¼Œæ’­æ”¾å™¨ç»Ÿè®¡
- âœ… **å•é¡µç®¡ç†** - é¡µé¢åˆ›å»ºï¼Œé¡µé¢ç¼–è¾‘ï¼Œé¡µé¢åˆ é™¤ï¼Œé¡µé¢æ’åº

### æŠ€æœ¯ç‰¹æ€§
- âœ… **SEOä¼˜åŒ–** - sitemapç”Ÿæˆï¼Œrobotsé…ç½®ï¼Œè‡ªå®šä¹‰URLï¼Œmetaæ ‡ç­¾
- âœ… **5ç§URLæ¨¡å¼** - æ”¯æŒslugä¼ªé™æ€ï¼Œè‡ªå®šä¹‰è§„åˆ™ï¼ŒSEOå‹å¥½
- âœ… **åŒç¼“å­˜é©±åŠ¨** - æ–‡ä»¶ç¼“å­˜/Redisç¼“å­˜ï¼Œç¼“å­˜é¢„çƒ­ï¼Œç¼“å­˜æ¸…ç†
- âœ… **åŒå­˜å‚¨é©±åŠ¨** - æœ¬åœ°å­˜å‚¨/Cloudflare R2ï¼Œæ–‡ä»¶ç®¡ç†ï¼ŒCDNåŠ é€Ÿ
- âœ… **å®‰å…¨é˜²æŠ¤** - CSRF/XSS/SQLæ³¨å…¥é˜²æŠ¤ï¼ŒIPæ··æ·†ï¼Œæ“ä½œå®¡è®¡
- âœ… **RESTful API** - 40+æ¥å£ï¼ŒTokenè®¤è¯ï¼ŒAPPæ”¯æŒï¼Œæ¥å£æ–‡æ¡£
- âœ… **æ¨¡æ¿ç³»ç»Ÿ** - è‡ªå®šä¹‰æ ‡ç­¾ï¼Œæ¨¡æ¿ç¼–è¯‘ï¼Œå˜é‡æ¸²æŸ“ï¼Œæ¨¡æ¿ç¼“å­˜
- âœ… **å¤šè¯­è¨€æ”¯æŒ** - ä¸­è‹±æ–‡ç•Œé¢ï¼Œå¤šè¯­è¨€æ¨¡æ¿ï¼Œå›½é™…åŒ–é…ç½®

## ğŸ“¥ é‡‡é›†åŠŸèƒ½

æ”¯æŒå¯¹æ¥èµ„æºç«™ APIï¼ˆJSON/XMLï¼‰ï¼Œè‡ªåŠ¨é‡‡é›†è§†é¢‘å…¥åº“ã€‚

### é‡‡é›†ç‰¹æ€§
- ğŸ”„ **è‡ªåŠ¨é‡‡é›†** - å®šæ—¶ä»»åŠ¡ï¼Œå¢é‡æ›´æ–°ï¼Œæ–­ç‚¹ç»­ä¼ 
- ğŸ¯ **åˆ†ç±»æ˜ å°„** - é‡‡é›†ç«™åˆ†ç±»è‡ªåŠ¨æ˜ å°„åˆ°æœ¬ç«™åˆ†ç±»
- ğŸ“Š **é‡‡é›†ç»Ÿè®¡** - é‡‡é›†è¿›åº¦ï¼ŒæˆåŠŸç‡ï¼Œé”™è¯¯æ—¥å¿—
- âš™ï¸ **çµæ´»é…ç½®** - é‡‡é›†é—´éš”ï¼Œé‡‡é›†æ•°é‡ï¼Œé‡‡é›†è§„åˆ™
- ğŸ” **é‡‡é›†æ—¥å¿—** - è¯¦ç»†æ—¥å¿—ï¼Œé”™è¯¯è¿½è¸ªï¼Œæ€§èƒ½ç›‘æ§

### å®šæ—¶é‡‡é›†é…ç½®

```bash
# æ¯å°æ—¶é‡‡é›†ä¸€æ¬¡ï¼ˆæ¨èï¼‰
0 * * * * php /www/site/cron.php collect --hours=1

# æ¯6å°æ—¶é‡‡é›†ä¸€æ¬¡
0 */6 * * * php /www/site/cron.php collect --hours=6

# æ¯å¤©å‡Œæ™¨2ç‚¹é‡‡é›†
0 2 * * * php /www/site/cron.php collect --hours=24
```

### é‡‡é›†ç«™é…ç½®ç¤ºä¾‹

```json
{
  "name": "èµ„æºç«™åç§°",
  "api": "https://api.example.com/api.php/provide/vod/",
  "token": "your_token_here",
  "categories": {
    "1": "ç”µå½±",
    "2": "ç”µè§†å‰§",
    "3": "ç»¼è‰º",
    "4": "åŠ¨æ¼«"
  }
}
```

### èµ„æºç«™åˆä½œ

> ğŸ“¢ èµ„æºç«™åˆä½œè”ç³» Telegram: [@ddys_io](https://t.me/ddys_io)

## ğŸ”§ é…ç½®è¯´æ˜

### åŸºç¡€é…ç½®

ç¼–è¾‘ `config/config.php`ï¼š

```php
// ç«™ç‚¹ä¿¡æ¯
define('SITE_NAME', 'é¦™è•‰å½±è§†');
define('SITE_URL', 'https://yourdomain.com');
define('SITE_KEYWORDS', 'é¦™è•‰CMS,BananaCMS,å…è´¹å½±è§†CMS');
define('SITE_DESCRIPTION', 'é¦™è•‰CMS - è½»é‡çº§å½±è§†å†…å®¹ç®¡ç†ç³»ç»Ÿ');

// æ•°æ®åº“é…ç½®
define('DB_HOST', 'localhost');
define('DB_NAME', 'bananacms');
define('DB_USER', 'root');
define('DB_PASS', 'password');

// ç¼“å­˜é©±åŠ¨ï¼ˆfile æˆ– redisï¼‰
define('CACHE_DRIVER', 'file');

// å­˜å‚¨é©±åŠ¨ï¼ˆlocal æˆ– r2ï¼‰
define('STORAGE_DRIVER', 'local');
```

### Redisé…ç½®ï¼ˆå¯é€‰ï¼‰

```php
// Redisç¼“å­˜é…ç½®
define('REDIS_HOST', '127.0.0.1');
define('REDIS_PORT', 6379);
define('REDIS_PASS', '');
define('REDIS_DB', 0);

// Redis Sessioné…ç½®
define('SESSION_DRIVER', 'redis');
```

### Cloudflare R2é…ç½®ï¼ˆå¯é€‰ï¼‰

```php
// Cloudflare R2å­˜å‚¨é…ç½®
define('R2_ACCOUNT_ID', 'your_account_id');
define('R2_ACCESS_KEY_ID', 'your_access_key');
define('R2_SECRET_ACCESS_KEY', 'your_secret_key');
define('R2_BUCKET', 'your_bucket_name');
define('R2_PUBLIC_URL', 'https://your-bucket.r2.dev');
```

### å®‰å…¨é…ç½®

```php
// ç®¡ç†å‘˜IPæ··æ·†ç›å€¼ï¼ˆè¯·ä¿®æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼‰
define('ADMIN_IP_SALT', 'your_random_salt_here');

// å®‰å…¨å¯†é’¥ï¼ˆè¯·ä¿®æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼‰
define('APP_SECRET', 'your_app_secret_here');

// è°ƒè¯•æ¨¡å¼ï¼ˆç”Ÿäº§ç¯å¢ƒè¯·è®¾ä¸ºfalseï¼‰
define('APP_DEBUG', false);
```

## ğŸŒ ä¼ªé™æ€é…ç½®

### Nginxé…ç½®ï¼ˆå®å¡”é¢æ¿ï¼‰

åœ¨å®å¡”é¢æ¿çš„ç«™ç‚¹è®¾ç½® â†’ ä¼ªé™æ€ä¸­æ·»åŠ ï¼š

```nginx
# Sitemap
location = /sitemap.xml {
    rewrite ^ /sitemap.php last;
}

# ç¦æ­¢è®¿é—®æ•æ„Ÿç›®å½•
location ~ ^/(config|core|models|controllers|views|runtime)/ {
    deny all;
}

# å‰å°ä¼ªé™æ€
location / {
    try_files $uri $uri/ /index.php?s=$uri&$args;
}
```

### Apacheé…ç½®

åˆ›å»º `.htaccess` æ–‡ä»¶ï¼š

```apache
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # Sitemap
    RewriteRule ^sitemap\.xml$ sitemap.php [QSA,L]

    # å‰å°è·¯ç”±
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.php?s=$1 [QSA,L]
</IfModule>

# ç¦æ­¢è®¿é—®æ•æ„Ÿç›®å½•
<FilesMatch "^(config|core|models|controllers|views|runtime)">
    Order deny,allow
    Deny from all
</FilesMatch>
```

### URLæ¨¡å¼è¯´æ˜

ç³»ç»Ÿæ”¯æŒ5ç§URLæ¨¡å¼ï¼Œå¯åœ¨åå°é…ç½®ï¼š

1. **æ¨¡å¼1**: `/vod/detail/123` (IDæ¨¡å¼)
2. **æ¨¡å¼2**: `/vod/123.html` (ID+HTML)
3. **æ¨¡å¼3**: `/video/123` (è‡ªå®šä¹‰å‰ç¼€)
4. **æ¨¡å¼4**: `/video/movie-name` (Slugæ— åç¼€)
5. **æ¨¡å¼5**: `/video/movie-name.html` (Slug+HTML)

> å®Œæ•´é…ç½®æ–‡ä»¶è§ `ä¼ªé™æ€/` ç›®å½•

## ğŸ“± API æ–‡æ¡£

åŸºç¡€åœ°å€: `/api.php`

è¿”å›æ ¼å¼: `{ "code": 0, "msg": "success", "data": {...} }`

### è®¤è¯æ–¹å¼

éœ€è¦ç™»å½•çš„æ¥å£ï¼ˆæ ‡è®°ğŸ”ï¼‰ï¼Œè¯·åœ¨è¯·æ±‚å¤´æºå¸¦ Tokenï¼š
```
X-Token: {token}
```

### æ¥å£åˆ—è¡¨

**ç³»ç»Ÿ**
| æ¥å£ | è¯´æ˜ |
|------|------|
| `?action=config` | è·å–ç«™ç‚¹é…ç½® |
| `?action=init` | APPåˆå§‹åŒ– |
| `?action=home` | é¦–é¡µæ•°æ® |

**ç”¨æˆ·**
| æ¥å£ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `?action=user.register` | username, password, email | æ³¨å†Œ |
| `?action=user.login` | username, password | ç™»å½• |
| `?action=user.info` | - | ç”¨æˆ·ä¿¡æ¯ ğŸ” |
| `?action=user.update` | nickname, avatar | æ›´æ–°èµ„æ–™ ğŸ” |
| `?action=user.password` | old_password, new_password | ä¿®æ”¹å¯†ç  ğŸ” |

**è§†é¢‘**
| æ¥å£ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `?action=vod.list` | page, limit, type, order | è§†é¢‘åˆ—è¡¨ |
| `?action=vod.detail` | id | è§†é¢‘è¯¦æƒ… |
| `?action=vod.play` | id, sid, nid | æ’­æ”¾åœ°å€ |
| `?action=vod.related` | id, limit | ç›¸å…³æ¨è |

**åˆ†ç±»/æ¼”å‘˜/æ–‡ç« **
| æ¥å£ | è¯´æ˜ |
|------|------|
| `?action=type.list` | åˆ†ç±»æ ‘ |
| `?action=actor.list` | æ¼”å‘˜åˆ—è¡¨ |
| `?action=actor.detail&id=` | æ¼”å‘˜è¯¦æƒ… |
| `?action=art.list` | æ–‡ç« åˆ—è¡¨ |
| `?action=art.detail&id=` | æ–‡ç« è¯¦æƒ… |

**æœç´¢**
| æ¥å£ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `?action=search` | wd, page, type | æœç´¢ |
| `?action=search.hot` | limit | çƒ­é—¨æœç´¢ |
| `?action=search.suggest` | wd | æœç´¢å»ºè®® |

**æ”¶è— ğŸ”**
| æ¥å£ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `?action=favorite.list` | page | æ”¶è—åˆ—è¡¨ |
| `?action=favorite.add` | vod_id | æ·»åŠ æ”¶è— |
| `?action=favorite.remove` | vod_id | å–æ¶ˆæ”¶è— |
| `?action=favorite.check` | vod_id | æ£€æŸ¥æ”¶è— |

**å†å² ğŸ”**
| æ¥å£ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `?action=history.list` | page | å†å²åˆ—è¡¨ |
| `?action=history.add` | vod_id, sid, nid, progress | æ·»åŠ å†å² |
| `?action=history.remove` | vod_id | åˆ é™¤å†å² |
| `?action=history.clear` | - | æ¸…ç©ºå†å² |

**è¯„è®º**
| æ¥å£ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `?action=comment.list` | type, id, page | è¯„è®ºåˆ—è¡¨ |
| `?action=comment.post` | type, target_id, content | å‘è¡¨ ğŸ” |
| `?action=comment.vote` | id, action | ç‚¹èµ/è¸© |

**è¯„åˆ†**
| æ¥å£ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `?action=score.submit` | type, target_id, score | æäº¤è¯„åˆ† |
| `?action=score.stats` | type, id | è¯„åˆ†ç»Ÿè®¡ |

**çŸ­è§†é¢‘**
| æ¥å£ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `?action=short.list` | page, type | åˆ—è¡¨ |
| `?action=short.detail` | id | è¯¦æƒ… |
| `?action=short.like` | id | ç‚¹èµ |

**å¹¿å‘Š**
| æ¥å£ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `?action=ad.get` | position | è·å–å¹¿å‘Š |
| `?action=ad.click` | id | è®°å½•ç‚¹å‡» |

### é”™è¯¯ç 

| code | è¯´æ˜ |
|------|------|
| 0 | æˆåŠŸ |
| 1 | é€šç”¨é”™è¯¯ |
| 2 | å‚æ•°é”™è¯¯ |
| 401 | æœªç™»å½•/Tokenè¿‡æœŸ |
| 403 | æƒé™ä¸è¶³ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **ç¯å¢ƒå‡†å¤‡**
   ```bash
   # å®‰è£…PHP 8.0+
   sudo apt install php8.0 php8.0-fpm php8.0-mysql php8.0-curl php8.0-redis
   
   # å®‰è£…MySQL 5.7+
   sudo apt install mysql-server
   
   # å®‰è£…Nginx
   sudo apt install nginx
   ```

2. **ä»£ç éƒ¨ç½²**
   ```bash
   # ä¸‹è½½ä»£ç 
   git clone https://github.com/your-repo/bananacms.git
   cd bananacms
   
   # è®¾ç½®æƒé™
   chmod -R 755 .
   chmod -R 777 upload/ runtime/
   ```

3. **é…ç½®æ–‡ä»¶**
   ```bash
   # å¤åˆ¶é…ç½®æ–‡ä»¶
   cp config/config.example.php config/config.php
   
   # ç¼–è¾‘é…ç½®
   nano config/config.php
   ```

4. **è¿è¡Œå®‰è£…**
   ```bash
   # è®¿é—®å®‰è£…å‘å¯¼
   https://yourdomain.com/install.php
   ```

5. **å®‰å…¨åŠ å›º**
   ```bash
   # åˆ é™¤å®‰è£…æ–‡ä»¶
   rm install.php data.sql *.md
   
   # è®¾ç½®åªè¯»æƒé™
   chmod 644 config/config.php
   ```

### Dockeréƒ¨ç½²

```dockerfile
FROM php:8.0-fpm-alpine

# å®‰è£…æ‰©å±•
RUN docker-php-ext-install pdo_mysql

# å¤åˆ¶ä»£ç 
COPY . /var/www/html

# è®¾ç½®æƒé™
RUN chmod -R 755 /var/www/html
RUN chmod -R 777 /var/www/html/upload /var/www/html/runtime

EXPOSE 9000
```

### å®šæ—¶ä»»åŠ¡é…ç½®

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ å®šæ—¶ä»»åŠ¡
# æ¯å°æ—¶é‡‡é›†ä¸€æ¬¡
0 * * * * php /www/site/cron.php collect --hours=1

# æ¯å¤©æ¸…ç†æ—¥å¿—
0 2 * * * php /www/site/cron.php clean --days=30

# æ¯å¤©ç”Ÿæˆsitemap
0 3 * * * php /www/site/sitemap.php
```

## ğŸ”§ å¸¸è§é—®é¢˜

### å®‰è£…é—®é¢˜

**Q: å®‰è£…æ—¶æç¤ºæ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥æ•°æ®åº“é…ç½®ä¿¡æ¯ï¼Œç¡®ä¿MySQLæœåŠ¡æ­£å¸¸è¿è¡Œï¼Œç”¨æˆ·æƒé™æ­£ç¡®ã€‚

**Q: å®‰è£…åæ— æ³•è®¿é—®åå°ï¼Ÿ**
A: æ£€æŸ¥ä¼ªé™æ€é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿admin.phpæ–‡ä»¶å­˜åœ¨ä¸”æœ‰æ‰§è¡Œæƒé™ã€‚

**Q: ä¸Šä¼ æ–‡ä»¶å¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥uploadç›®å½•æƒé™æ˜¯å¦ä¸º777ï¼ŒPHPä¸Šä¼ é™åˆ¶æ˜¯å¦è¶³å¤Ÿå¤§ã€‚

### åŠŸèƒ½é—®é¢˜

**Q: é‡‡é›†ä¸å·¥ä½œï¼Ÿ**
A: æ£€æŸ¥cURLæ‰©å±•æ˜¯å¦å®‰è£…ï¼Œé‡‡é›†ç«™APIæ˜¯å¦æ­£å¸¸ï¼Œå®šæ—¶ä»»åŠ¡æ˜¯å¦é…ç½®ã€‚

**Q: ç¼“å­˜ä¸ç”Ÿæ•ˆï¼Ÿ**
A: æ£€æŸ¥runtimeç›®å½•æƒé™ï¼ŒRedisè¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œç¼“å­˜é…ç½®æ˜¯å¦æ­£ç¡®ã€‚

**Q: è§†é¢‘æ— æ³•æ’­æ”¾ï¼Ÿ**
A: æ£€æŸ¥æ’­æ”¾åœ°å€æ˜¯å¦æœ‰æ•ˆï¼Œæ’­æ”¾å™¨é…ç½®æ˜¯å¦æ­£ç¡®ï¼ŒHTTPSæ··åˆå†…å®¹é—®é¢˜ã€‚

### æ€§èƒ½é—®é¢˜

**Q: ç½‘ç«™è®¿é—®æ…¢ï¼Ÿ**
A: å¯ç”¨Redisç¼“å­˜ï¼Œé…ç½®CDNåŠ é€Ÿï¼Œä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼Œå¯ç”¨Gzipå‹ç¼©ã€‚

**Q: æ•°æ®åº“æŸ¥è¯¢æ…¢ï¼Ÿ**
A: æ£€æŸ¥æ•°æ®åº“ç´¢å¼•ï¼Œä¼˜åŒ–SQLæŸ¥è¯¢ï¼Œè€ƒè™‘è¯»å†™åˆ†ç¦»ï¼Œå®šæœŸæ¸…ç†æ—¥å¿—ã€‚

## ğŸ“ˆ å‡çº§æŒ‡å—

### ç‰ˆæœ¬å‡çº§

1. **å¤‡ä»½æ•°æ®**
   ```bash
   # å¤‡ä»½æ•°æ®åº“
   mysqldump -u root -p bananacms > backup.sql
   
   # å¤‡ä»½æ–‡ä»¶
   tar -czf backup.tar.gz upload/ config/
   ```

2. **ä¸‹è½½æ–°ç‰ˆæœ¬**
   ```bash
   # ä¸‹è½½æ–°ç‰ˆæœ¬
   wget https://github.com/your-repo/bananacms/releases/latest
   ```

3. **è¦†ç›–æ–‡ä»¶**
   ```bash
   # ä¿ç•™é…ç½®å’Œä¸Šä¼ æ–‡ä»¶
   cp -r upload/ upload_backup/
   cp config/config.php config_backup.php
   
   # è¦†ç›–æ–°æ–‡ä»¶
   # æ¢å¤é…ç½®å’Œä¸Šä¼ æ–‡ä»¶
   ```

4. **æ•°æ®åº“å‡çº§**
   ```bash
   # è¿è¡Œå‡çº§è„šæœ¬ï¼ˆå¦‚æœæœ‰ï¼‰
   php upgrade.php
   ```

### æ•°æ®è¿ç§»

ä»å…¶ä»–CMSè¿ç§»åˆ°BananaCMSï¼š

1. **å¯¼å‡ºæ•°æ®** - ä»åŸç³»ç»Ÿå¯¼å‡ºè§†é¢‘ã€åˆ†ç±»ã€ç”¨æˆ·æ•°æ®
2. **æ ¼å¼è½¬æ¢** - è½¬æ¢ä¸ºBananaCMSæ•°æ®æ ¼å¼
3. **å¯¼å…¥æ•°æ®** - ä½¿ç”¨å¯¼å…¥å·¥å…·æ‰¹é‡å¯¼å…¥
4. **URLé‡å®šå‘** - é…ç½®301é‡å®šå‘ä¿æŒSEO

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘ç¯å¢ƒ

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone https://github.com/your-repo/bananacms.git
   cd bananacms
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   # æ— éœ€Composerï¼ŒåŸç”ŸPHPé¡¹ç›®
   ```

3. **é…ç½®ç¯å¢ƒ**
   ```bash
   cp config/config.example.php config/config.php
   # ç¼–è¾‘é…ç½®æ–‡ä»¶
   ```

### ä»£ç è§„èŒƒ

- éµå¾ªPSR-4è‡ªåŠ¨åŠ è½½è§„èŒƒ
- ä½¿ç”¨PSR-12ä»£ç é£æ ¼
- æ‰€æœ‰ç±»å’Œæ–¹æ³•å¿…é¡»æœ‰æ³¨é‡Š
- æäº¤å‰è¿è¡Œæµ‹è¯•

### æäº¤æµç¨‹

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç 
4. åˆ›å»ºPull Request

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å®˜æ–¹æ¸ é“
- **å®˜æ–¹ç½‘ç«™**: [https://bananacms.com](https://bananacms.com)
- **æ–‡æ¡£ä¸­å¿ƒ**: [https://docs.bananacms.com](https://docs.bananacms.com)
- **GitHub**: [https://github.com/bananacms/bananacms](https://github.com/bananacms/bananacms)

### ç¤¾åŒºæ”¯æŒ
- **Telegramç¾¤**: [@BananaCMS](https://t.me/BananaCMS)
- **QQç¾¤**: 123456789
- **å¾®ä¿¡ç¾¤**: æ‰«ç åŠ å…¥

### å•†ä¸šæ”¯æŒ
- **å®šåˆ¶å¼€å‘**: è”ç³»å®˜æ–¹è·å–æŠ¥ä»·
- **æŠ€æœ¯å’¨è¯¢**: æä¾›ä¸“ä¸šæŠ€æœ¯å’¨è¯¢æœåŠ¡
- **éƒ¨ç½²æœåŠ¡**: æä¾›ä¸€ç«™å¼éƒ¨ç½²æœåŠ¡

## ğŸ›  æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|------|
| åç«¯è¯­è¨€ | PHP | 8.0+ | åŸç”ŸPHPï¼Œæ— æ¡†æ¶ä¾èµ– |
| æ•°æ®åº“ | MySQL | 5.7+ | æ”¯æŒInnoDBå¼•æ“ |
| å‰ç«¯æ¡†æ¶ | Tailwind CSS | 3.x | å“åº”å¼è®¾è®¡ï¼Œç§»åŠ¨ç«¯ä¼˜åŒ– |
| ç¼“å­˜ç³»ç»Ÿ | File / Redis | - | åŒé©±åŠ¨ï¼Œæ”¯æŒé›†ç¾¤ |
| å­˜å‚¨ç³»ç»Ÿ | Local / R2 | - | æœ¬åœ°å­˜å‚¨/äº‘å­˜å‚¨ |
| ä¼šè¯ç®¡ç† | File / Redis | - | æ”¯æŒåˆ†å¸ƒå¼Session |
| è§†é¢‘è½¬ç  | FFmpeg | 4.0+ | å¯é€‰ï¼Œæ”¯æŒå¤šæ ¼å¼è½¬ç  |

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### æ•°æ®å®‰å…¨
- **SQLæ³¨å…¥é˜²æŠ¤** - PDOé¢„å¤„ç†è¯­å¥ï¼Œå‚æ•°ç»‘å®š
- **XSSé˜²æŠ¤** - è¾“å‡ºè½¬ä¹‰ï¼ŒHTMLæ ‡ç­¾è¿‡æ»¤
- **CSRFé˜²æŠ¤** - TokenéªŒè¯ï¼Œè¡¨å•ä¿æŠ¤
- **å¯†ç å®‰å…¨** - BCryptå“ˆå¸Œï¼Œç›å€¼åŠ å¯†

### è®¿é—®æ§åˆ¶
- **ç›®å½•ä¿æŠ¤** - æ•æ„Ÿç›®å½•è®¿é—®é™åˆ¶
- **æ–‡ä»¶ä¿æŠ¤** - é…ç½®æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ä¿æŠ¤
- **IPæ··æ·†** - ç®¡ç†å‘˜IPåœ°å€æ··æ·†å­˜å‚¨
- **ä¼šè¯å®‰å…¨** - HttpOnly Cookieï¼ŒSameSiteå±æ€§

### å®¡è®¡æ—¥å¿—
- **æ“ä½œæ—¥å¿—** - ç®¡ç†å‘˜æ“ä½œå®Œæ•´è®°å½•
- **ç™»å½•æ—¥å¿—** - ç™»å½•å°è¯•ï¼ŒIPåœ°å€è®°å½•
- **é‡‡é›†æ—¥å¿—** - é‡‡é›†æ“ä½œï¼Œé”™è¯¯è¿½è¸ª
- **æœç´¢æ—¥å¿—** - æœç´¢è¡Œä¸ºï¼Œçƒ­è¯ç»Ÿè®¡

## ğŸ¨ æ¨¡æ¿ç³»ç»Ÿ

### æ¨¡æ¿æ ‡ç­¾

BananaCMSæä¾›å¼ºå¤§çš„æ¨¡æ¿æ ‡ç­¾ç³»ç»Ÿï¼š

```html
<!-- è§†é¢‘åˆ—è¡¨ -->
{xpk:vod num="10" order="time" type="1"}
  <div class="video-item">
    <h3>{$vod.vod_name}</h3>
    <img src="{$vod.vod_pic}" alt="{$vod.vod_name}">
    <p>{$vod.vod_content}</p>
  </div>
{/xpk:vod}

<!-- åˆ†ç±»åˆ—è¡¨ -->
{xpk:type}
  <a href="{$type.type_url}">{$type.type_name}</a>
{/xpk:type}

<!-- æ¼”å‘˜åˆ—è¡¨ -->
{xpk:actor num="20"}
  <div class="actor-item">
    <img src="{$actor.actor_pic}" alt="{$actor.actor_name}">
    <span>{$actor.actor_name}</span>
  </div>
{/xpk:actor}

<!-- çƒ­é—¨è§†é¢‘ -->
{xpk:hot num="10" type="1"}
  <div class="hot-video">{$vod.vod_name}</div>
{/xpk:hot}

<!-- å¹¿å‘Šä½ -->
{xpk:ad position="home_top"}

<!-- è¯„åˆ†ç»„ä»¶ -->
{xpk:score type="vod" id="123" size="large"}
```

### æ¨¡æ¿å˜é‡

å¸¸ç”¨æ¨¡æ¿å˜é‡ï¼š

```php
// ç«™ç‚¹ä¿¡æ¯
{$siteConfig.site_name}        // ç«™ç‚¹åç§°
{$siteConfig.site_keywords}    // ç«™ç‚¹å…³é”®è¯
{$siteConfig.site_description} // ç«™ç‚¹æè¿°

// ç”¨æˆ·ä¿¡æ¯
{$user.user_name}              // ç”¨æˆ·å
{$user.user_nick_name}         // æ˜µç§°
{$user.user_avatar}            // å¤´åƒ

// è§†é¢‘ä¿¡æ¯
{$vod.vod_name}                // è§†é¢‘åç§°
{$vod.vod_pic}                 // è§†é¢‘å°é¢
{$vod.vod_content}             // è§†é¢‘ç®€ä»‹
{$vod.vod_play_url}            // æ’­æ”¾åœ°å€
```

### è‡ªå®šä¹‰æ¨¡æ¿

1. å¤åˆ¶ `template/default/` ç›®å½•
2. é‡å‘½åä¸ºä½ çš„æ¨¡æ¿åç§°
3. ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶
4. åœ¨åå°åˆ‡æ¢æ¨¡æ¿

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥
- **é¡µé¢ç¼“å­˜** - é¦–é¡µã€åˆ—è¡¨é¡µé™æ€åŒ–
- **æ•°æ®ç¼“å­˜** - çƒ­é—¨æ•°æ®Redisç¼“å­˜
- **æ¨¡æ¿ç¼“å­˜** - æ¨¡æ¿ç¼–è¯‘ç¼“å­˜
- **å›¾ç‰‡ç¼“å­˜** - CDNåŠ é€Ÿï¼Œæµè§ˆå™¨ç¼“å­˜

### æ•°æ®åº“ä¼˜åŒ–
- **ç´¢å¼•ä¼˜åŒ–** - å…³é”®å­—æ®µå»ºç«‹ç´¢å¼•
- **æŸ¥è¯¢ä¼˜åŒ–** - é¿å…N+1æŸ¥è¯¢
- **åˆ†é¡µä¼˜åŒ–** - å¤§æ•°æ®é‡åˆ†é¡µä¼˜åŒ–
- **è¿æ¥æ± ** - æ•°æ®åº“è¿æ¥å¤ç”¨

### å‰ç«¯ä¼˜åŒ–
- **èµ„æºå‹ç¼©** - CSS/JSæ–‡ä»¶å‹ç¼©
- **å›¾ç‰‡ä¼˜åŒ–** - WebPæ ¼å¼ï¼Œæ‡’åŠ è½½
- **CDNåŠ é€Ÿ** - é™æ€èµ„æºCDNåˆ†å‘
- **æµè§ˆå™¨ç¼“å­˜** - åˆç†è®¾ç½®ç¼“å­˜å¤´

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

| ç±»å‹ | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| æ ¸å¿ƒç±»åº“ | 11ä¸ª | Database, Router, Cache, Templateç­‰ |
| æ•°æ®æ¨¡å‹ | 22ä¸ª | Vod, User, Comment, Scoreç­‰å®Œæ•´æ¨¡å‹ |
| å‰å°æ§åˆ¶å™¨ | 12ä¸ª | é¦–é¡µã€è§†é¢‘ã€ç”¨æˆ·ç­‰åŠŸèƒ½æ§åˆ¶å™¨ |
| åå°æ§åˆ¶å™¨ | 22ä¸ª | å®Œæ•´çš„åå°ç®¡ç†åŠŸèƒ½ |
| APIæ¥å£ | 40+ä¸ª | å®Œæ•´çš„RESTful API |
| æ¨¡æ¿æ ‡ç­¾ | 10+ä¸ª | è‡ªå®šä¹‰æ¨¡æ¿æ ‡ç­¾ç³»ç»Ÿ |
| æ•°æ®è¡¨ | 25+ä¸ª | å®Œæ•´çš„æ•°æ®åº“ç»“æ„ |
| ä»£ç è¡Œæ•° | 50000+ | é«˜è´¨é‡PHPä»£ç  |

## ğŸ“¢ ç¤¾åŒº

- **Telegram é¢‘é“**: [@BananaCMS](https://t.me/BananaCMS)
- **GitHub**: [BananaCMS](https://github.com/bananacms/bananacms)
- **å®˜æ–¹ç½‘ç«™**: [https://bananacms.com](https://bananacms.com)

## ğŸ“„ å¼€æºåè®®

MIT License - è‡ªç”±ä½¿ç”¨ï¼Œå•†ä¸šå‹å¥½

---

**BananaCMS** - æ¯”è‹¹æœæ›´è½»é‡ï¼Œæ¯”æ©™å­æ›´ç”œç¾ ğŸŒ

Powered by [XPornKitæˆäººå¯¼èˆª](https://xpornkit.com/zh)