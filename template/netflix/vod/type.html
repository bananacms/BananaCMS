<?php 
$netflixLayoutPath = TPL_PATH . 'netflix/layouts/';
include $netflixLayoutPath . 'header.php'; 
?>

<!-- 分类页 -->
<div class="pt-20 md:pt-24 px-4 md:px-12 pb-10">
    <!-- 分类标题 -->
    <div class="mb-6">
        <h1 class="text-2xl md:text-3xl font-bold"><?php echo htmlspecialchars($type['type_name']); ?></h1>
        <?php if ($type['type_des']): ?>
        <p class="text-gray-400 mt-2"><?php echo htmlspecialchars($type['type_des']); ?></p>
        <?php endif; ?>
    </div>

    <!-- 筛选条件 -->
    <div class="mb-8 space-y-4">
        <!-- 子分类 -->
        <?php if (!empty($subTypes)): ?>
        <div class="flex flex-wrap gap-2">
            <a href="<?php echo xpk_page_url('type', ['id' => $type['type_id'], 'slug' => $type['type_en']]); ?>" 
               class="<?php echo empty($currentSubType) ? 'bg-red-600' : 'bg-gray-800 hover:bg-gray-700'; ?> px-4 py-2 rounded text-sm transition">全部</a>
            <?php foreach ($subTypes as $sub): ?>
            <a href="<?php echo xpk_page_url('type', ['id' => $sub['type_id'], 'slug' => $sub['type_en']]); ?>" 
               class="<?php echo ($currentSubType == $sub['type_id']) ? 'bg-red-600' : 'bg-gray-800 hover:bg-gray-700'; ?> px-4 py-2 rounded text-sm transition">
                <?php echo htmlspecialchars($sub['type_name']); ?>
            </a>
            <?php endforeach; ?>
        </div>
        <?php endif; ?>

        <!-- 年份筛选 -->
        <?php if (!empty($years)): ?>
        <div class="flex flex-wrap gap-2">
            <span class="text-gray-500 text-sm py-2">年份：</span>
            <a href="?<?php echo http_build_query(array_merge($_GET, ['year' => ''])); ?>" 
               class="<?php echo empty($_GET['year']) ? 'text-red-500' : 'text-gray-400 hover:text-white'; ?> px-2 py-2 text-sm">全部</a>
            <?php foreach ($years as $year): ?>
            <a href="?<?php echo http_build_query(array_merge($_GET, ['year' => $year])); ?>" 
               class="<?php echo ($_GET['year'] ?? '') == $year ? 'text-red-500' : 'text-gray-400 hover:text-white'; ?> px-2 py-2 text-sm">
                <?php echo $year; ?>
            </a>
            <?php endforeach; ?>
        </div>
        <?php endif; ?>

        <!-- 地区筛选 -->
        <?php if (!empty($areas)): ?>
        <div class="flex flex-wrap gap-2">
            <span class="text-gray-500 text-sm py-2">地区：</span>
            <a href="?<?php echo http_build_query(array_merge($_GET, ['area' => ''])); ?>" 
               class="<?php echo empty($_GET['area']) ? 'text-red-500' : 'text-gray-400 hover:text-white'; ?> px-2 py-2 text-sm">全部</a>
            <?php foreach ($areas as $area): ?>
            <a href="?<?php echo http_build_query(array_merge($_GET, ['area' => $area])); ?>" 
               class="<?php echo ($_GET['area'] ?? '') == $area ? 'text-red-500' : 'text-gray-400 hover:text-white'; ?> px-2 py-2 text-sm">
                <?php echo htmlspecialchars($area); ?>
            </a>
            <?php endforeach; ?>
        </div>
        <?php endif; ?>
    </div>

    <!-- 视频列表 -->
    <?php if (!empty($vodList)): ?>
    <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2 md:gap-4">
        <?php foreach ($vodList as $vod): ?>
        <a href="<?php echo xpk_page_url('vod_detail', ['id' => $vod['vod_id'], 'slug' => $vod['vod_slug']]); ?>" class="card cursor-pointer relative overflow-hidden rounded group">
            <img src="<?php echo $vod['vod_pic'] ?: '/static/images/no-image.svg'; ?>" alt="<?php echo htmlspecialchars($vod['vod_name']); ?>" class="w-full aspect-[2/3] object-cover bg-gray-800">
            <div class="card-overlay absolute inset-0 bg-black/60 opacity-0 flex items-center justify-center">
                <span class="w-10 h-10 md:w-12 md:h-12 bg-white/90 rounded-full flex items-center justify-center">
                    <svg class="w-5 h-5 md:w-6 md:h-6 text-black ml-1" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                </span>
            </div>
            <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/80 to-transparent">
                <p class="text-xs md:text-sm truncate"><?php echo htmlspecialchars($vod['vod_name']); ?></p>
                <?php if ($vod['vod_year']): ?>
                <p class="text-xs text-gray-400"><?php echo $vod['vod_year']; ?></p>
                <?php endif; ?>
            </div>
            <?php if ($vod['vod_remarks']): ?>
            <span class="absolute top-1 right-1 bg-black/70 text-white text-xs px-1.5 py-0.5 rounded"><?php echo $vod['vod_remarks']; ?></span>
            <?php endif; ?>
        </a>
        <?php endforeach; ?>
    </div>

    <!-- 分页 -->
    <?php if ($totalPages > 1): ?>
    <div class="flex justify-center items-center space-x-2 mt-10">
        <?php if ($page > 1): ?>
        <a href="?<?php echo http_build_query(array_merge($_GET, ['page' => $page - 1])); ?>" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded transition">上一页</a>
        <?php endif; ?>
        
        <span class="text-gray-400 px-4">第 <?php echo $page; ?> / <?php echo $totalPages; ?> 页</span>
        
        <?php if ($page < $totalPages): ?>
        <a href="?<?php echo http_build_query(array_merge($_GET, ['page' => $page + 1])); ?>" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded transition">下一页</a>
        <?php endif; ?>
    </div>
    <?php endif; ?>

    <?php else: ?>
    <div class="text-center py-20">
        <p class="text-gray-500 text-lg">暂无内容</p>
    </div>
    <?php endif; ?>
</div>

<?php include $netflixLayoutPath . 'footer.php'; ?>
