# 香蕉CMS 模板制作指南

## 目录结构

模板位于 `template/default/` 目录下：

```
template/default/
├── index/              # 首页
│   └── index.html      # 首页模板
├── vod/                # 视频相关
│   ├── type.html       # 分类列表页
│   ├── detail.html     # 视频详情页
│   ├── play.html       # 视频播放页
│   └── hot.html        # 热门视频页
├── actor/              # 演员相关
│   ├── index.html      # 演员列表页
│   └── detail.html     # 演员详情页
├── art/                # 文章相关
│   ├── index.html      # 文章列表页
│   └── detail.html     # 文章详情页
├── search/             # 搜索
│   └── index.html      # 搜索结果页
├── user/               # 用户相关
│   ├── login.html      # 登录页
│   ├── register.html   # 注册页
│   └── center.html     # 用户中心
├── short/              # 短视频/短剧
│   ├── index.html      # 短视频滑动页
│   ├── drama.html      # 短剧列表页
│   ├── detail.html     # 短剧详情页
│   └── play.html       # 短剧播放页
├── link/               # 友链
│   └── index.html      # 友链页面
├── page/               # 单页面
│   └── show.html       # 单页展示
├── error/              # 错误页
│   └── 404.html        # 404页面
└── components/         # 公共组件
    └── pagination.php  # 分页组件
```

## 模板语法

### 变量输出

```html
<!-- 转义输出（推荐） -->
<?= htmlspecialchars($变量名) ?>
<?php echo htmlspecialchars($vod['vod_name']); ?>

<!-- 原始输出（用于HTML内容） -->
<?= $art['art_content'] ?>
```

### 条件判断

```html
<?php if (!empty($vod['vod_actor'])): ?>
    <p>演员：<?= htmlspecialchars($vod['vod_actor']) ?></p>
<?php endif; ?>

<?php if ($page > 1): ?>
    <a href="...">上一页</a>
<?php endif; ?>
```

### 循环遍历

```html
<?php foreach ($vodList as $vod): ?>
    <div class="item">
        <h3><?= htmlspecialchars($vod['vod_name']) ?></h3>
    </div>
<?php endforeach; ?>

<?php foreach ($vodList as $index => $vod): ?>
    <span><?= $index + 1 ?></span>
<?php endforeach; ?>
```

### 引入公共文件

```html
<!-- 引入头部 -->
<?php include VIEW_PATH . 'layouts/header.php'; ?>

<!-- 引入底部 -->
<?php include VIEW_PATH . 'layouts/footer.php'; ?>

<!-- 引入分页组件 -->
<?php include TPL_PATH . 'default/components/pagination.php'; ?>
```

## 常用函数

| 函数 | 说明 | 示例 |
|------|------|------|
| `xpk_url($path)` | 生成站点URL | `xpk_url('user/login')` |
| `xpk_page_url($type, $params)` | 生成页面URL（支持伪静态） | `xpk_page_url('vod_detail', ['id' => 1, 'slug' => 'xxx'])` |
| `xpk_ad($position)` | 输出广告 | `<?= xpk_ad('home_top') ?>` |
| `htmlspecialchars()` | HTML转义 | `htmlspecialchars($vod['vod_name'])` |
| `mb_substr()` | 截取字符串 | `mb_substr($vod['vod_name'], 0, 1)` |
| `date()` | 格式化日期 | `date('Y-m-d', $art['art_time'])` |
| `number_format()` | 格式化数字 | `number_format($vod['vod_hits'])` |

### URL类型参数

| 类型 | 参数 | 说明 |
|------|------|------|
| `vod_detail` | id, slug | 视频详情 |
| `vod_play` | id, slug, sid, nid | 视频播放 |
| `type` | id, slug | 分类列表 |
| `type_page` | id, slug, page | 分类分页 |
| `actor_detail` | id, slug | 演员详情 |
| `art_detail` | id, slug | 文章详情 |

## 全局变量

以下变量在所有模板中可用：

| 变量 | 类型 | 说明 |
|------|------|------|
| `$siteName` | string | 站点名称 |
| `$siteUrl` | string | 站点URL |
| `$siteKeywords` | string | 站点关键词 |
| `$siteDescription` | string | 站点描述 |
| `$siteConfig` | array | 站点配置数组 |
| `$navTypes` | array | 导航分类列表 |
| `$user` | array/null | 当前登录用户信息 |
| `$title` | string | 页面标题 |
| `$keywords` | string | 页面关键词 |
| `$description` | string | 页面描述 |

## 各页面变量详解

### 首页 (index/index.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$newList` | array | 最新视频列表 |
| `$hotList` | array | 热门视频列表 |
| `$typeVods` | array | 按分类的视频，键为分类ID |

### 视频分类页 (vod/type.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$type` | array | 当前分类信息 |
| `$vodList` | array | 视频列表 |
| `$page` | int | 当前页码 |
| `$totalPages` | int | 总页数 |
| `$total` | int | 总数量 |
| `$baseUrl` | string | 分页基础URL |

### 视频详情页 (vod/detail.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$vod` | array | 视频详情 |
| `$relatedList` | array | 相关推荐视频 |

**$vod 字段：**

| 字段 | 说明 |
|------|------|
| `vod_id` | 视频ID |
| `vod_name` | 视频名称 |
| `vod_sub` | 副标题 |
| `vod_pic` | 封面图 |
| `vod_actor` | 演员 |
| `vod_director` | 导演 |
| `vod_year` | 年份 |
| `vod_area` | 地区 |
| `vod_content` | 简介 |
| `vod_remarks` | 更新状态 |
| `vod_hits` | 播放次数 |
| `vod_score` | 评分 |
| `vod_slug` | URL别名 |
| `type_id` | 分类ID |
| `type_name` | 分类名称 |
| `play_list` | 播放列表数组 |
| `down_list` | 下载列表数组 |

**play_list 结构：**
```php
[
    [
        'from' => '播放源名称',
        'sid' => 1,
        'count' => 12,
        'episodes' => [
            ['nid' => 1, 'name' => '第1集', 'url' => '...'],
            ...
        ]
    ],
    ...
]
```

### 视频播放页 (vod/play.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$vod` | array | 视频信息 |
| `$playUrls` | array | 所有播放地址 |
| `$sid` | int | 当前播放源索引 |
| `$nid` | int | 当前集数索引 |
| `$currentUrl` | string | 当前播放地址 |

### 热门视频页 (vod/hot.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$vodList` | array | 热门视频列表 |
| `$page` | int | 当前页码 |
| `$totalPages` | int | 总页数 |
| `$total` | int | 总数量 |
| `$baseUrl` | string | 分页基础URL |

### 演员列表页 (actor/index.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$actorList` | array | 演员列表 |
| `$page` | int | 当前页码 |
| `$totalPages` | int | 总页数 |
| `$total` | int | 总数量 |

### 演员详情页 (actor/detail.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$actor` | array | 演员信息 |
| `$vodList` | array | 演员作品列表 |

**$actor 字段：**

| 字段 | 说明 |
|------|------|
| `actor_id` | 演员ID |
| `actor_name` | 演员名称 |
| `actor_en` | 英文名/别名 |
| `actor_pic` | 头像 |
| `actor_sex` | 性别 |
| `actor_area` | 地区 |
| `actor_birthday` | 生日 |
| `actor_height` | 身高 |
| `actor_content` | 简介 |

### 文章列表页 (art/index.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$artList` | array | 文章列表 |
| `$page` | int | 当前页码 |
| `$totalPages` | int | 总页数 |

### 文章详情页 (art/detail.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$art` | array | 文章详情 |

**$art 字段：**

| 字段 | 说明 |
|------|------|
| `art_id` | 文章ID |
| `art_name` | 文章标题 |
| `art_pic` | 封面图 |
| `art_author` | 作者 |
| `art_content` | 内容(HTML) |
| `art_time` | 发布时间戳 |
| `art_hits` | 阅读次数 |
| `art_slug` | URL别名 |

### 搜索页 (search/index.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$keyword` | string | 搜索关键词 |
| `$vodList` | array | 搜索结果 |
| `$hotKeywords` | array | 热门搜索词 |
| `$recentKeywords` | array | 最新搜索词 |
| `$page` | int | 当前页码 |
| `$totalPages` | int | 总页数 |
| `$total` | int | 结果总数 |
| `$baseUrl` | string | 分页基础URL |

### 用户登录页 (user/login.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$csrfToken` | string | CSRF令牌 |

### 用户注册页 (user/register.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$csrfToken` | string | CSRF令牌 |

### 用户中心 (user/center.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$user` | array | 用户信息 |

**$user 字段：**

| 字段 | 说明 |
|------|------|
| `user_id` | 用户ID |
| `user_name` | 用户名 |
| `user_nick_name` | 昵称 |
| `user_email` | 邮箱 |
| `user_pic` | 头像 |
| `user_reg_time` | 注册时间戳 |
| `user_login_time` | 最后登录时间戳 |
| `user_login_num` | 登录次数 |

### 短剧列表页 (short/drama.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$list` | array | 短剧列表 |
| `$page` | int | 当前页码 |
| `$totalPages` | int | 总页数 |

### 短剧详情页 (short/detail.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$short` | array | 短剧信息 |
| `$episodes` | array | 剧集列表 |

**$short 字段：**

| 字段 | 说明 |
|------|------|
| `short_id` | 短剧ID |
| `short_name` | 短剧名称 |
| `short_pic` | 封面图 |
| `short_desc` | 简介 |
| `short_tags` | 标签(逗号分隔) |
| `short_hits` | 播放次数 |
| `short_likes` | 点赞数 |

### 短剧播放页 (short/play.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$short` | array | 短剧信息 |
| `$episodes` | array | 剧集列表 |
| `$currentEp` | array | 当前剧集 |
| `$epIndex` | int | 当前集索引(从0开始) |

### 友链页 (link/index.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$links` | array | 友链列表 |
| `$csrfToken` | string | CSRF令牌 |

### 单页面 (page/show.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$pageTitle` | string | 页面标题 |
| `$pageContent` | string | 页面内容(HTML) |

### 404页面 (error/404.html)

| 变量 | 类型 | 说明 |
|------|------|------|
| `$errorMsg` | string | 错误信息 |

## 广告位

使用 `<?= xpk_ad('位置标识') ?>` 输出广告：

| 位置标识 | 说明 | 建议页面 |
|----------|------|----------|
| `home_top` | 首页顶部 | 首页 |
| `home_middle` | 首页中部 | 首页 |
| `home_bottom` | 首页底部 | 首页 |
| `detail_top` | 详情页顶部 | 视频详情 |
| `detail_bottom` | 详情页底部 | 视频详情 |
| `play_top` | 播放页顶部 | 播放页 |
| `play_bottom` | 播放页底部 | 播放页 |
| `list_top` | 列表页顶部 | 分类/搜索 |
| `sidebar` | 侧边栏 | 通用 |
| `float` | 浮动广告 | 通用 |

## 分页组件

分页组件需要以下变量：

```php
$page       // 当前页码
$totalPages // 总页数
$baseUrl    // 基础URL（不含/page/部分）
```

引入方式：
```php
<?php include TPL_PATH . 'default/components/pagination.php'; ?>
```

## 制作新模板

1. 复制 `template/default/` 为新目录，如 `template/mytheme/`
2. 修改模板文件
3. 在后台 系统设置 中切换模板

## 注意事项

1. 所有用户输入必须使用 `htmlspecialchars()` 转义
2. 表单必须包含 CSRF 令牌：`<input type="hidden" name="_token" value="<?= $csrfToken ?>">`
3. 模板文件使用 `.html` 扩展名，但实际是 PHP 文件
4. 静态资源放在 `static/` 目录
5. 上传文件放在 `upload/` 目录

## 相关链接

- Telegram 频道: [@BananaCMS](https://t.me/BananaCMS)
- 问题反馈: [GitHub Issues](https://github.com/bananacms/BananaCMS/issues)