# ğŸŒ BananaCMS API æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç» BananaCMS çš„ RESTful API æ¥å£ï¼Œé€‚ç”¨äºå¼€å‘åŸç”Ÿ APPã€å°ç¨‹åºã€ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ç­‰ã€‚

## ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [è®¤è¯æ–¹å¼](#è®¤è¯æ–¹å¼)
- [å“åº”æ ¼å¼](#å“åº”æ ¼å¼)
- [é”™è¯¯ç ](#é”™è¯¯ç )
- [æ¥å£åˆ—è¡¨](#æ¥å£åˆ—è¡¨)
  - [ç³»ç»Ÿæ¥å£](#ç³»ç»Ÿæ¥å£)
  - [ç”¨æˆ·æ¥å£](#ç”¨æˆ·æ¥å£)
  - [è§†é¢‘æ¥å£](#è§†é¢‘æ¥å£)
  - [åˆ†ç±»æ¥å£](#åˆ†ç±»æ¥å£)
  - [æ¼”å‘˜æ¥å£](#æ¼”å‘˜æ¥å£)
  - [æ–‡ç« æ¥å£](#æ–‡ç« æ¥å£)
  - [æœç´¢æ¥å£](#æœç´¢æ¥å£)
  - [æ”¶è—æ¥å£](#æ”¶è—æ¥å£)
  - [å†å²è®°å½•æ¥å£](#å†å²è®°å½•æ¥å£)
  - [è¯„è®ºæ¥å£](#è¯„è®ºæ¥å£)
  - [è¯„åˆ†æ¥å£](#è¯„åˆ†æ¥å£)
  - [çŸ­è§†é¢‘æ¥å£](#çŸ­è§†é¢‘æ¥å£)
  - [å¹¿å‘Šæ¥å£](#å¹¿å‘Šæ¥å£)
  - [å‹æƒ…é“¾æ¥æ¥å£](#å‹æƒ…é“¾æ¥æ¥å£)
  - [å•é¡µé¢æ¥å£](#å•é¡µé¢æ¥å£)
- [å¼€å‘ç¤ºä¾‹](#å¼€å‘ç¤ºä¾‹)

---

## å¿«é€Ÿå¼€å§‹

### åŸºç¡€ä¿¡æ¯

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| æ¥å£åœ°å€ | `https://ä½ çš„åŸŸå/api.php` |
| è¯·æ±‚æ–¹å¼ | GET / POST |
| æ•°æ®æ ¼å¼ | JSON |
| å­—ç¬¦ç¼–ç  | UTF-8 |

### è¯·æ±‚ç¤ºä¾‹

```bash
# GET è¯·æ±‚
curl "https://example.com/api.php?action=vod.list&page=1&limit=20"

# POST è¯·æ±‚
curl -X POST "https://example.com/api.php?action=user.login" \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"123456"}'

# å¸¦è®¤è¯çš„è¯·æ±‚
curl "https://example.com/api.php?action=user.info" \
  -H "X-Token: your_token_here"
```

---

## è®¤è¯æ–¹å¼

éœ€è¦ç™»å½•çš„æ¥å£ï¼ˆæ ‡è®° ğŸ”ï¼‰éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ Tokenï¼š

```
X-Token: {token}
```

æˆ–è€…ä½¿ç”¨ Authorization å¤´ï¼š

```
Authorization: Bearer {token}
```

Token é€šè¿‡ç™»å½•æ¥å£è·å–ï¼Œæœ‰æ•ˆæœŸ 30 å¤©ã€‚

### éœ€è¦è®¤è¯çš„æ¥å£

- `user.info` - è·å–ç”¨æˆ·ä¿¡æ¯
- `user.update` - æ›´æ–°ç”¨æˆ·èµ„æ–™
- `user.password` - ä¿®æ”¹å¯†ç 
- `favorite.*` - æ”¶è—ç›¸å…³
- `history.*` - å†å²è®°å½•ç›¸å…³
- `comment.post` - å‘è¡¨è¯„è®º
- `comment.delete` - åˆ é™¤è¯„è®º

---

## å“åº”æ ¼å¼

æ‰€æœ‰æ¥å£è¿”å›ç»Ÿä¸€çš„ JSON æ ¼å¼ï¼š

```json
{
  "code": 0,
  "msg": "success",
  "data": { ... }
}
```

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| code | int | çŠ¶æ€ç ï¼Œ0 è¡¨ç¤ºæˆåŠŸ |
| msg | string | æç¤ºä¿¡æ¯ |
| data | object/array | è¿”å›æ•°æ® |

---

## é”™è¯¯ç 

| code | è¯´æ˜ |
|------|------|
| 0 | æˆåŠŸ |
| 1 | é€šç”¨é”™è¯¯ |
| 2 | å‚æ•°é”™è¯¯ |
| 401 | æœªç™»å½•/Tokenè¿‡æœŸ |
| 403 | æƒé™ä¸è¶³ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

## æ¥å£åˆ—è¡¨

### ç³»ç»Ÿæ¥å£

#### è·å–ç«™ç‚¹é…ç½®

```
GET ?action=config
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "site_name": "é¦™è•‰å½±è§†",
    "site_logo": "/upload/logo.png",
    "site_notice": "æ¬¢è¿è®¿é—®",
    "player_config": {
      "autoplay": true,
      "muted": false
    }
  }
}
```

#### APP åˆå§‹åŒ–

ä¸€æ¬¡æ€§è·å–å¤šé¡¹æ•°æ®ï¼Œå‡å°‘è¯·æ±‚æ¬¡æ•°ã€‚

```
GET ?action=init
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "config": {
      "site_name": "é¦™è•‰å½±è§†",
      "site_logo": "/upload/logo.png"
    },
    "types": [...],
    "banners": [...],
    "hot_search": ["å…³é”®è¯1", "å…³é”®è¯2"]
  }
}
```

#### é¦–é¡µæ•°æ®

```
GET ?action=home
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "recommend": [...],
    "latest": [...],
    "type_1": {
      "type_id": 1,
      "type_name": "ç”µå½±",
      "list": [...]
    },
    "banners": [...]
  }
}
```

---

### ç”¨æˆ·æ¥å£

#### ç”¨æˆ·æ³¨å†Œ

```
POST ?action=user.register
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | æ˜¯ | ç”¨æˆ·åï¼ˆ3-20å­—ç¬¦ï¼‰ |
| password | string | æ˜¯ | å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰ |
| email | string | å¦ | é‚®ç®± |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "user_id": 1,
    "token": "eyJ1aWQiOjEsImV4cCI6..."
  }
}
```

#### ç”¨æˆ·ç™»å½•

```
POST ?action=user.login
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | æ˜¯ | ç”¨æˆ·å |
| password | string | æ˜¯ | å¯†ç  |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "user_id": 1,
    "username": "test",
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "avatar": "/upload/avatar/1.jpg",
    "token": "eyJ1aWQiOjEsImV4cCI6..."
  }
}
```

#### ç”¨æˆ·é€€å‡º ğŸ”

```
POST ?action=user.logout
```

**è¯´æ˜ï¼š** Token æ–¹å¼æ— éœ€æœåŠ¡ç«¯å¤„ç†ï¼Œå®¢æˆ·ç«¯åˆ é™¤æœ¬åœ° Token å³å¯ã€‚

#### è·å–ç”¨æˆ·ä¿¡æ¯ ğŸ”

```
GET ?action=user.info
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "user_id": 1,
    "username": "test",
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "email": "test@example.com",
    "avatar": "/upload/avatar/1.jpg",
    "points": 100,
    "reg_time": "2024-01-01"
  }
}
```

#### æ›´æ–°ç”¨æˆ·èµ„æ–™ ğŸ”

```
POST ?action=user.update
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| nickname | string | å¦ | æ˜µç§° |
| avatar | string | å¦ | å¤´åƒURL |

#### ä¿®æ”¹å¯†ç  ğŸ”

```
POST ?action=user.password
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| old_password | string | æ˜¯ | åŸå¯†ç  |
| new_password | string | æ˜¯ | æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰ |

---

### è§†é¢‘æ¥å£

#### è§†é¢‘åˆ—è¡¨

```
GET ?action=vod.list
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | int | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| limit | int | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20ï¼Œæœ€å¤§50 |
| type | int | å¦ | åˆ†ç±»ID |
| order | string | å¦ | æ’åºï¼štime/hits/score/up |
| year | string | å¦ | å¹´ä»½ç­›é€‰ |
| area | string | å¦ | åœ°åŒºç­›é€‰ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "list": [
      {
        "vod_id": 1,
        "vod_name": "è§†é¢‘åç§°",
        "vod_pic": "/upload/vod/1.jpg",
        "vod_remarks": "æ›´æ–°è‡³ç¬¬10é›†",
        "vod_score": 8.5,
        "vod_year": "2024",
        "vod_area": "å¤§é™†",
        "type_name": "ç”µè§†å‰§"
      }
    ],
    "page": 1,
    "limit": 20,
    "total": 100,
    "pages": 5
  }
}
```

#### çƒ­é—¨è§†é¢‘

```
GET ?action=vod.hot
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | int | å¦ | é¡µç  |
| limit | int | å¦ | æ¯é¡µæ•°é‡ |

#### æœ€æ–°è§†é¢‘

```
GET ?action=vod.latest
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | int | å¦ | é¡µç  |
| limit | int | å¦ | æ¯é¡µæ•°é‡ |

#### è§†é¢‘è¯¦æƒ…

```
GET ?action=vod.detail&id=1
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | int | æ˜¯ | è§†é¢‘ID |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "vod": {
      "vod_id": 1,
      "vod_name": "è§†é¢‘åç§°",
      "vod_sub": "å‰¯æ ‡é¢˜",
      "vod_pic": "/upload/vod/1.jpg",
      "vod_actor": "æ¼”å‘˜1,æ¼”å‘˜2",
      "vod_director": "å¯¼æ¼”",
      "vod_year": "2024",
      "vod_area": "å¤§é™†",
      "vod_lang": "å›½è¯­",
      "vod_score": 8.5,
      "vod_hits": 10000,
      "vod_remarks": "æ›´æ–°è‡³ç¬¬10é›†",
      "vod_content": "è§†é¢‘ç®€ä»‹...",
      "type_name": "ç”µè§†å‰§",
      "play_from": ["æ’­æ”¾æº1", "æ’­æ”¾æº2"],
      "play_list": [
        [
          {"name": "ç¬¬1é›†", "url": "https://..."},
          {"name": "ç¬¬2é›†", "url": "https://..."}
        ]
      ]
    },
    "score": {
      "count": 100,
      "average": 8.5,
      "distribution": {...}
    },
    "is_favorite": false
  }
}
```

#### è·å–æ’­æ”¾ä¿¡æ¯

```
GET ?action=vod.play&id=1&sid=1&nid=1
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | int | æ˜¯ | è§†é¢‘ID |
| sid | int | å¦ | æ’­æ”¾æºåºå·ï¼Œé»˜è®¤1 |
| nid | int | å¦ | é›†æ•°åºå·ï¼Œé»˜è®¤1 |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "vod_id": 1,
    "vod_name": "è§†é¢‘åç§°",
    "episode": "ç¬¬1é›†",
    "play_url": "https://...",
    "sid": 1,
    "nid": 1,
    "progress": 0,
    "has_next": true,
    "has_prev": false
  }
}
```

#### ç›¸å…³æ¨è

```
GET ?action=vod.related&id=1&limit=10
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | int | æ˜¯ | è§†é¢‘ID |
| limit | int | å¦ | æ•°é‡ï¼Œé»˜è®¤10 |

---

### åˆ†ç±»æ¥å£

#### åˆ†ç±»åˆ—è¡¨ï¼ˆæ ‘å½¢ï¼‰

```
GET ?action=type.list
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": [
    {
      "type_id": 1,
      "type_name": "ç”µå½±",
      "type_en": "movie",
      "type_pid": 0,
      "level": 0
    },
    {
      "type_id": 2,
      "type_name": "åŠ¨ä½œç‰‡",
      "type_en": "action",
      "type_pid": 1,
      "level": 1
    }
  ]
}
```

#### åˆ†ç±»ä¸‹çš„è§†é¢‘

```
GET ?action=type.vods&id=1&page=1&limit=20
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | int | æ˜¯ | åˆ†ç±»ID |
| page | int | å¦ | é¡µç  |
| limit | int | å¦ | æ¯é¡µæ•°é‡ |

---

### æ¼”å‘˜æ¥å£

#### æ¼”å‘˜åˆ—è¡¨

```
GET ?action=actor.list&page=1&limit=20
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | int | å¦ | é¡µç  |
| limit | int | å¦ | æ¯é¡µæ•°é‡ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "list": [
      {
        "actor_id": 1,
        "actor_name": "æ¼”å‘˜å",
        "actor_pic": "/upload/actor/1.jpg",
        "actor_hits": 1000
      }
    ],
    "page": 1,
    "limit": 20,
    "total": 50,
    "pages": 3
  }
}
```

#### æ¼”å‘˜è¯¦æƒ…

```
GET ?action=actor.detail&id=1
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "actor": {
      "actor_id": 1,
      "actor_name": "æ¼”å‘˜å",
      "actor_pic": "/upload/actor/1.jpg",
      "actor_content": "æ¼”å‘˜ç®€ä»‹..."
    },
    "vods": [...]
  }
}
```

---

### æ–‡ç« æ¥å£

#### æ–‡ç« åˆ—è¡¨

```
GET ?action=art.list&page=1&limit=20&type=1
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | int | å¦ | é¡µç  |
| limit | int | å¦ | æ¯é¡µæ•°é‡ |
| type | int | å¦ | åˆ†ç±»ID |

#### æ–‡ç« è¯¦æƒ…

```
GET ?action=art.detail&id=1
```

---

### æœç´¢æ¥å£

#### æœç´¢

```
GET ?action=search&wd=å…³é”®è¯&page=1&limit=20&type=vod
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| wd | string | æ˜¯ | æœç´¢å…³é”®è¯ |
| page | int | å¦ | é¡µç  |
| limit | int | å¦ | æ¯é¡µæ•°é‡ |
| type | string | å¦ | æœç´¢ç±»å‹ï¼švod/actor/art |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "list": [...],
    "page": 1,
    "limit": 20,
    "total": 10,
    "pages": 1
  }
}
```

#### çƒ­é—¨æœç´¢

```
GET ?action=search.hot&limit=10
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": ["å…³é”®è¯1", "å…³é”®è¯2", "å…³é”®è¯3"]
}
```

#### æœç´¢å»ºè®®

```
GET ?action=search.suggest&wd=å…³é”®
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": ["å…³é”®è¯1", "å…³é”®è¯2"]
}
```

---

### æ”¶è—æ¥å£ ğŸ”

#### æ”¶è—åˆ—è¡¨

```
GET ?action=favorite.list&page=1&limit=20
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "list": [
      {
        "fav_id": 1,
        "vod_id": 1,
        "fav_time": 1704067200,
        "vod_name": "è§†é¢‘åç§°",
        "vod_pic": "/upload/vod/1.jpg",
        "vod_remarks": "æ›´æ–°è‡³ç¬¬10é›†",
        "vod_score": 8.5
      }
    ],
    "page": 1,
    "limit": 20,
    "total": 5,
    "pages": 1
  }
}
```

#### æ·»åŠ æ”¶è—

```
POST ?action=favorite.add
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| vod_id | int | æ˜¯ | è§†é¢‘ID |

#### å–æ¶ˆæ”¶è—

```
POST ?action=favorite.remove
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| vod_id | int | æ˜¯ | è§†é¢‘ID |

#### æ£€æŸ¥æ˜¯å¦æ”¶è—

```
GET ?action=favorite.check&vod_id=1
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "is_favorite": true
  }
}
```

---

### å†å²è®°å½•æ¥å£ ğŸ”

#### å†å²åˆ—è¡¨

```
GET ?action=history.list&page=1&limit=20
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "list": [
      {
        "history_id": 1,
        "vod_id": 1,
        "sid": 1,
        "nid": 5,
        "progress": 1200,
        "duration": 2400,
        "watch_time": 1704067200,
        "vod_name": "è§†é¢‘åç§°",
        "vod_pic": "/upload/vod/1.jpg",
        "vod_remarks": "æ›´æ–°è‡³ç¬¬10é›†"
      }
    ],
    "page": 1,
    "limit": 20,
    "total": 10,
    "pages": 1
  }
}
```

#### æ·»åŠ /æ›´æ–°å†å²

```
POST ?action=history.add
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| vod_id | int | æ˜¯ | è§†é¢‘ID |
| sid | int | å¦ | æ’­æ”¾æºåºå· |
| nid | int | å¦ | é›†æ•°åºå· |
| progress | int | å¦ | æ’­æ”¾è¿›åº¦ï¼ˆç§’ï¼‰ |
| duration | int | å¦ | è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰ |

#### åˆ é™¤å†å²

```
POST ?action=history.remove
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| vod_id | int | æ˜¯ | è§†é¢‘ID |

#### æ¸…ç©ºå†å²

```
POST ?action=history.clear
```

---

### è¯„è®ºæ¥å£

#### è¯„è®ºåˆ—è¡¨

```
GET ?action=comment.list&type=vod&id=1&page=1&limit=20
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| type | string | æ˜¯ | ç±»å‹ï¼švod/art |
| id | int | æ˜¯ | ç›®æ ‡ID |
| page | int | å¦ | é¡µç  |
| limit | int | å¦ | æ¯é¡µæ•°é‡ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "list": [
      {
        "comment_id": 1,
        "user_id": 1,
        "user_name": "ç”¨æˆ·å",
        "user_nick_name": "æ˜µç§°",
        "user_pic": "/upload/avatar/1.jpg",
        "comment_content": "è¯„è®ºå†…å®¹",
        "comment_time": 1704067200,
        "comment_up": 10,
        "comment_down": 2,
        "replies": [...],
        "reply_count": 3
      }
    ],
    "total": 50
  }
}
```

#### å‘è¡¨è¯„è®º ğŸ”

```
POST ?action=comment.post
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| type | string | æ˜¯ | ç±»å‹ï¼švod/art |
| target_id | int | æ˜¯ | ç›®æ ‡ID |
| content | string | æ˜¯ | è¯„è®ºå†…å®¹ |
| parent_id | int | å¦ | çˆ¶è¯„è®ºIDï¼ˆå›å¤æ—¶ï¼‰ |

#### åˆ é™¤è¯„è®º ğŸ”

```
POST ?action=comment.delete
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | int | æ˜¯ | è¯„è®ºID |

#### è¯„è®ºæŠ•ç¥¨ï¼ˆç‚¹èµ/è¸©ï¼‰

```
POST ?action=comment.vote
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | int | æ˜¯ | è¯„è®ºID |
| action | string | æ˜¯ | æ“ä½œï¼šup/down |

---

### è¯„åˆ†æ¥å£

#### æäº¤è¯„åˆ†

```
POST ?action=score.submit
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| type | string | æ˜¯ | ç±»å‹ï¼švod/art |
| target_id | int | æ˜¯ | ç›®æ ‡ID |
| score | int | æ˜¯ | è¯„åˆ†ï¼ˆ1-10ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "action": "new",
    "score": 8
  }
}
```

#### è¯„åˆ†ç»Ÿè®¡

```
GET ?action=score.stats&type=vod&id=1
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "count": 100,
    "average": 8.5,
    "total": 850,
    "distribution": {
      "1": 2,
      "2": 1,
      "3": 3,
      "4": 5,
      "5": 8,
      "6": 10,
      "7": 15,
      "8": 25,
      "9": 20,
      "10": 11
    }
  }
}
```

---

### çŸ­è§†é¢‘æ¥å£

#### çŸ­è§†é¢‘åˆ—è¡¨

```
GET ?action=short.list&page=1&limit=10&type=video
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | int | å¦ | é¡µç  |
| limit | int | å¦ | æ¯é¡µæ•°é‡ |
| type | string | å¦ | ç±»å‹ï¼švideoï¼ˆçŸ­è§†é¢‘ï¼‰/dramaï¼ˆçŸ­å‰§ï¼‰ |

#### çŸ­è§†é¢‘è¯¦æƒ…

```
GET ?action=short.detail&id=1
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "short_id": 1,
    "short_name": "çŸ­è§†é¢‘æ ‡é¢˜",
    "short_pic": "/upload/short/1.jpg",
    "short_url": "https://...",
    "short_type": "video",
    "short_hits": 1000,
    "short_likes": 50,
    "episodes": [...]
  }
}
```

#### çŸ­è§†é¢‘ç‚¹èµ

```
POST ?action=short.like
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | int | æ˜¯ | çŸ­è§†é¢‘ID |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "likes": 51
  }
}
```

#### çŸ­å‰§å‰§é›†åˆ—è¡¨

```
GET ?action=short.episodes&id=1
```

#### éšæœºçŸ­è§†é¢‘ï¼ˆæ»‘åŠ¨æ’­æ”¾ï¼‰

```
GET ?action=short.random&limit=10&exclude=1
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| limit | int | å¦ | æ•°é‡ |
| exclude | int | å¦ | æ’é™¤çš„ID |

---

### å¹¿å‘Šæ¥å£

#### è·å–å¹¿å‘Š

```
GET ?action=ad.get&position=home_top
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| position | string | æ˜¯ | å¹¿å‘Šä½ç½® |

**å¹¿å‘Šä½ç½®ï¼š**
| ä½ç½® | è¯´æ˜ |
|------|------|
| home_top | é¦–é¡µé¡¶éƒ¨æ¨ªå¹… |
| home_float | å…¨ç«™æ‚¬æµ®å¹¿å‘Š |
| detail_top | è¯¦æƒ…é¡µé¡¶éƒ¨ |
| detail_bottom | è¯¦æƒ…é¡µåº•éƒ¨ |
| play_pause | æ’­æ”¾å™¨æš‚åœå¹¿å‘Š |
| play_before | ç‰‡å¤´å¹¿å‘Š |
| sidebar | ä¾§è¾¹æ å¹¿å‘Š |
| list_insert | åˆ—è¡¨é¡µæ’å…¥å¹¿å‘Š |
| popup | å…¨ç«™å¼¹çª—å¹¿å‘Š |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": [
    {
      "ad_id": 1,
      "ad_title": "å¹¿å‘Šæ ‡é¢˜",
      "ad_type": "image",
      "ad_image": "/upload/ad/1.jpg",
      "ad_link": "https://..."
    }
  ]
}
```

#### å¹¿å‘Šç‚¹å‡»ç»Ÿè®¡

```
POST ?action=ad.click
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | int | æ˜¯ | å¹¿å‘ŠID |

#### å¹¿å‘Šå±•ç¤ºç»Ÿè®¡

```
POST ?action=ad.show
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | int | æ˜¯ | å¹¿å‘ŠID |

---

### å‹æƒ…é“¾æ¥æ¥å£

#### å‹é“¾åˆ—è¡¨

```
GET ?action=link.list
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": [
    {
      "link_id": 1,
      "link_name": "ç½‘ç«™åç§°",
      "link_url": "https://...",
      "link_logo": "/upload/link/1.png"
    }
  ]
}
```

#### ç”³è¯·å‹é“¾

```
POST ?action=link.apply
```

**å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| name | string | æ˜¯ | ç½‘ç«™åç§° |
| url | string | æ˜¯ | ç½‘ç«™åœ°å€ |
| logo | string | å¦ | Logoåœ°å€ |
| contact | string | å¦ | è”ç³»æ–¹å¼ |

---

### å•é¡µé¢æ¥å£

#### é¡µé¢åˆ—è¡¨

```
GET ?action=page.list
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": [
    {
      "page_id": 1,
      "page_slug": "about",
      "page_title": "å…³äºæˆ‘ä»¬"
    },
    {
      "page_id": 2,
      "page_slug": "contact",
      "page_title": "è”ç³»æ–¹å¼"
    }
  ]
}
```

#### é¡µé¢è¯¦æƒ…

```
GET ?action=page.detail&slug=about
```

æˆ–

```
GET ?action=page.detail&id=1
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "page_id": 1,
    "page_slug": "about",
    "page_title": "å…³äºæˆ‘ä»¬",
    "page_content": "<h2>å…³äºæˆ‘ä»¬</h2><p>...</p>"
  }
}
```

---

## å¼€å‘ç¤ºä¾‹

### Android (Kotlin) ç¤ºä¾‹

```kotlin
// 1. å®šä¹‰ API æœåŠ¡
interface ApiService {
    @GET("api.php")
    suspend fun getVodList(
        @Query("action") action: String = "vod.list",
        @Query("page") page: Int = 1,
        @Query("limit") limit: Int = 20,
        @Query("type") type: Int? = null
    ): ApiResponse<VodListData>

    @POST("api.php")
    suspend fun login(
        @Query("action") action: String = "user.login",
        @Body body: LoginRequest
    ): ApiResponse<LoginData>

    @GET("api.php")
    suspend fun getUserInfo(
        @Header("X-Token") token: String,
        @Query("action") action: String = "user.info"
    ): ApiResponse<UserInfo>
}

// 2. æ•°æ®ç±»
data class ApiResponse<T>(
    val code: Int,
    val msg: String,
    val data: T?
)

data class VodListData(
    val list: List<Vod>,
    val page: Int,
    val total: Int,
    val pages: Int
)

data class Vod(
    val vod_id: Int,
    val vod_name: String,
    val vod_pic: String,
    val vod_remarks: String,
    val vod_score: Float
)

// 3. ä½¿ç”¨ç¤ºä¾‹
class VodRepository(private val api: ApiService) {
    suspend fun getVodList(page: Int, typeId: Int?): Result<VodListData> {
        return try {
            val response = api.getVodList(page = page, type = typeId)
            if (response.code == 0 && response.data != null) {
                Result.success(response.data)
            } else {
                Result.failure(Exception(response.msg))
            }
        } catch (e: Exception) {
            Result.failure(e)
        }
    }
}
```

### iOS (Swift) ç¤ºä¾‹

```swift
// 1. å®šä¹‰æ¨¡å‹
struct ApiResponse<T: Codable>: Codable {
    let code: Int
    let msg: String
    let data: T?
}

struct Vod: Codable {
    let vod_id: Int
    let vod_name: String
    let vod_pic: String
    let vod_remarks: String
    let vod_score: Float
}

struct VodListData: Codable {
    let list: [Vod]
    let page: Int
    let total: Int
    let pages: Int
}

// 2. API è¯·æ±‚
class ApiManager {
    static let shared = ApiManager()
    private let baseURL = "https://example.com/api.php"
    
    func getVodList(page: Int, type: Int? = nil) async throws -> VodListData {
        var urlComponents = URLComponents(string: baseURL)!
        urlComponents.queryItems = [
            URLQueryItem(name: "action", value: "vod.list"),
            URLQueryItem(name: "page", value: String(page)),
            URLQueryItem(name: "limit", value: "20")
        ]
        if let type = type {
            urlComponents.queryItems?.append(URLQueryItem(name: "type", value: String(type)))
        }
        
        let (data, _) = try await URLSession.shared.data(from: urlComponents.url!)
        let response = try JSONDecoder().decode(ApiResponse<VodListData>.self, from: data)
        
        guard response.code == 0, let result = response.data else {
            throw NSError(domain: "", code: response.code, userInfo: [NSLocalizedDescriptionKey: response.msg])
        }
        return result
    }
    
    func login(username: String, password: String) async throws -> LoginData {
        var request = URLRequest(url: URL(string: "\(baseURL)?action=user.login")!)
        request.httpMethod = "POST"
        request.setValue("application/json", forHTTPHeaderField: "Content-Type")
        request.httpBody = try JSONEncoder().encode(["username": username, "password": password])
        
        let (data, _) = try await URLSession.shared.data(for: request)
        let response = try JSONDecoder().decode(ApiResponse<LoginData>.self, from: data)
        
        guard response.code == 0, let result = response.data else {
            throw NSError(domain: "", code: response.code, userInfo: [NSLocalizedDescriptionKey: response.msg])
        }
        return result
    }
}
```

### Flutter (Dart) ç¤ºä¾‹

```dart
// 1. å®šä¹‰æ¨¡å‹
class ApiResponse<T> {
  final int code;
  final String msg;
  final T? data;

  ApiResponse({required this.code, required this.msg, this.data});

  factory ApiResponse.fromJson(Map<String, dynamic> json, T Function(dynamic) fromJsonT) {
    return ApiResponse(
      code: json['code'],
      msg: json['msg'],
      data: json['data'] != null ? fromJsonT(json['data']) : null,
    );
  }
}

class Vod {
  final int vodId;
  final String vodName;
  final String vodPic;
  final String vodRemarks;
  final double vodScore;

  Vod({
    required this.vodId,
    required this.vodName,
    required this.vodPic,
    required this.vodRemarks,
    required this.vodScore,
  });

  factory Vod.fromJson(Map<String, dynamic> json) {
    return Vod(
      vodId: json['vod_id'],
      vodName: json['vod_name'],
      vodPic: json['vod_pic'],
      vodRemarks: json['vod_remarks'] ?? '',
      vodScore: (json['vod_score'] ?? 0).toDouble(),
    );
  }
}

// 2. API æœåŠ¡
class ApiService {
  static const String baseUrl = 'https://example.com/api.php';
  String? _token;

  void setToken(String token) => _token = token;

  Future<Map<String, dynamic>> _get(String action, [Map<String, dynamic>? params]) async {
    final uri = Uri.parse(baseUrl).replace(queryParameters: {
      'action': action,
      ...?params?.map((k, v) => MapEntry(k, v.toString())),
    });

    final response = await http.get(uri, headers: {
      if (_token != null) 'X-Token': _token!,
    });

    return json.decode(response.body);
  }

  Future<Map<String, dynamic>> _post(String action, Map<String, dynamic> body) async {
    final uri = Uri.parse('$baseUrl?action=$action');

    final response = await http.post(
      uri,
      headers: {
        'Content-Type': 'application/json',
        if (_token != null) 'X-Token': _token!,
      },
      body: json.encode(body),
    );

    return json.decode(response.body);
  }

  // è·å–è§†é¢‘åˆ—è¡¨
  Future<List<Vod>> getVodList({int page = 1, int? type}) async {
    final result = await _get('vod.list', {'page': page, if (type != null) 'type': type});
    if (result['code'] != 0) throw Exception(result['msg']);
    return (result['data']['list'] as List).map((e) => Vod.fromJson(e)).toList();
  }

  // ç”¨æˆ·ç™»å½•
  Future<String> login(String username, String password) async {
    final result = await _post('user.login', {'username': username, 'password': password});
    if (result['code'] != 0) throw Exception(result['msg']);
    final token = result['data']['token'];
    setToken(token);
    return token;
  }
}

// 3. ä½¿ç”¨ç¤ºä¾‹
void main() async {
  final api = ApiService();
  
  // è·å–è§†é¢‘åˆ—è¡¨
  final vods = await api.getVodList(page: 1, type: 1);
  print('è·å–åˆ° ${vods.length} ä¸ªè§†é¢‘');
  
  // ç™»å½•
  final token = await api.login('test', '123456');
  print('ç™»å½•æˆåŠŸï¼ŒToken: $token');
}
```

### JavaScript/TypeScript ç¤ºä¾‹

```typescript
// api.ts
const BASE_URL = 'https://example.com/api.php';

interface ApiResponse<T> {
  code: number;
  msg: string;
  data: T;
}

interface Vod {
  vod_id: number;
  vod_name: string;
  vod_pic: string;
  vod_remarks: string;
  vod_score: number;
}

class ApiClient {
  private token: string | null = null;

  setToken(token: string) {
    this.token = token;
  }

  private async request<T>(action: string, params?: Record<string, any>, method = 'GET'): Promise<T> {
    const url = new URL(BASE_URL);
    url.searchParams.set('action', action);
    
    if (method === 'GET' && params) {
      Object.entries(params).forEach(([k, v]) => url.searchParams.set(k, String(v)));
    }

    const headers: Record<string, string> = {
      'Content-Type': 'application/json',
    };
    if (this.token) {
      headers['X-Token'] = this.token;
    }

    const response = await fetch(url.toString(), {
      method,
      headers,
      body: method === 'POST' ? JSON.stringify(params) : undefined,
    });

    const result: ApiResponse<T> = await response.json();
    if (result.code !== 0) {
      throw new Error(result.msg);
    }
    return result.data;
  }

  // è·å–è§†é¢‘åˆ—è¡¨
  async getVodList(page = 1, type?: number) {
    return this.request<{ list: Vod[]; total: number }>('vod.list', { page, type });
  }

  // ç™»å½•
  async login(username: string, password: string) {
    const data = await this.request<{ token: string }>('user.login', { username, password }, 'POST');
    this.setToken(data.token);
    return data;
  }

  // æ·»åŠ æ”¶è—
  async addFavorite(vodId: number) {
    return this.request('favorite.add', { vod_id: vodId }, 'POST');
  }
}

// ä½¿ç”¨
const api = new ApiClient();

// è·å–è§†é¢‘åˆ—è¡¨
const { list, total } = await api.getVodList(1, 1);
console.log(`å…± ${total} ä¸ªè§†é¢‘`);

// ç™»å½•åæ“ä½œ
await api.login('test', '123456');
await api.addFavorite(1);
```

---

## æ³¨æ„äº‹é¡¹

1. **è·¨åŸŸé—®é¢˜**ï¼šAPI å·²é…ç½® CORSï¼Œæ”¯æŒè·¨åŸŸè¯·æ±‚
2. **è¯·æ±‚é¢‘ç‡**ï¼šå»ºè®®æ§åˆ¶è¯·æ±‚é¢‘ç‡ï¼Œé¿å…è¢«é™æµ
3. **Token å­˜å‚¨**ï¼šå®¢æˆ·ç«¯åº”å®‰å…¨å­˜å‚¨ Tokenï¼Œå¦‚ iOS Keychainã€Android EncryptedSharedPreferences
4. **å›¾ç‰‡åœ°å€**ï¼šè¿”å›çš„å›¾ç‰‡åœ°å€å¯èƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œéœ€è¦æ‹¼æ¥ç«™ç‚¹åŸŸå
5. **åˆ†é¡µå‚æ•°**ï¼šlimit æœ€å¤§å€¼ä¸º 50ï¼Œè¶…è¿‡ä¼šè¢«é™åˆ¶
6. **ç¼“å­˜ç­–ç•¥**ï¼šé¦–é¡µã€åˆ†ç±»ç­‰æ•°æ®å»ºè®®å®¢æˆ·ç«¯ç¼“å­˜ï¼Œå‡å°‘è¯·æ±‚


